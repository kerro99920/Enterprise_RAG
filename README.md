# RAG æ™ºèƒ½çŸ¥è¯†é—®ç­”ç³»ç»Ÿ

Windows + Docker + Python  
åŸºäº Milvus + MySQL + Redis + å¤§æ¨¡å‹çš„ç§æœ‰åŒ– RAG é—®ç­”ç³»ç»Ÿ

## æŠ€æœ¯æ ˆ
- Python
- Docker / Docker Compose
- Milvus
- MySQL
- Redis
- LLM

## ç›®å½•ç»“æ„
```
enterprise_rag/
â”œâ”€â”€ app/
â”‚ â”œâ”€â”€ main.py                # é¡¹ç›®å…¥å£
â”‚ â”œâ”€â”€ api/                   # API æ¥å£
â”‚ â”‚ â””â”€â”€ v1/
â”‚ â”‚ â”œâ”€â”€ qa.py                    # é—®ç­”æ¥å£
â”‚ â”‚ â”œâ”€â”€ document.py              # æ–‡æ¡£ä¸Šä¼  / ç®¡ç†æ¥å£
â”‚ â”‚ â””â”€â”€ admin.py                 # ç®¡ç†æ¥å£ï¼ˆé¢„ç•™ï¼‰
â”‚ â”‚
â”‚ â”œâ”€â”€ core/                      # æ ¸å¿ƒæ¨¡å—
â”‚ â”‚ â”œâ”€â”€ config.py                # é…ç½®ä¸­å¿ƒ
â”‚ â”‚ â”œâ”€â”€ logger.py                # æ—¥å¿—ç®¡ç†
â”‚ â”‚ â”œâ”€â”€ security.py              # æƒé™ / SSOï¼ˆé¢„ç•™ï¼‰
â”‚ â”‚ â””â”€â”€ constants.py             # å…¨å±€å¸¸é‡
â”‚ â”‚
â”‚ â”œâ”€â”€ services/                  # æ ¸å¿ƒä¸šåŠ¡æœåŠ¡
â”‚ â”‚ â”œâ”€â”€ document/                # æ–‡æ¡£å¤„ç†å­ç³»ç»Ÿ
â”‚ â”‚ â”‚ â”œâ”€â”€ loader.py              # æ–‡æ¡£åŠ è½½è°ƒåº¦
â”‚ â”‚ â”‚ â”œâ”€â”€ pdf_parser.py          # PDF è§£æ
â”‚ â”‚ â”‚ â”œâ”€â”€ word_parser.py         # Word è§£æ
â”‚ â”‚ â”‚ â”œâ”€â”€ ocr_parser.py          # OCR æ–‡å­—è¯†åˆ«
â”‚ â”‚ â”‚ â”œâ”€â”€ cleaner.py             # æ–‡æœ¬æ¸…æ´—
â”‚ â”‚ â”‚ â”œâ”€â”€ splitter.py            # æ–‡æ¡£åˆ‡åˆ†ä¸º Chunk
â”‚ â”‚ â”‚ â””â”€â”€ metadata.py            # å…ƒæ•°æ®å°è£…
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ embedding/               # å‘é‡åŒ–å­ç³»ç»Ÿ
â”‚ â”‚ â”‚ â”œâ”€â”€ embedding_model.py     # æ¨¡å‹åŠ è½½
â”‚ â”‚ â”‚ â””â”€â”€ embedder.py            # æ‰¹é‡å‘é‡ç”Ÿæˆ
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ retrieval/               # æ£€ç´¢å­ç³»ç»Ÿï¼ˆRAG æ ¸å¿ƒï¼‰
â”‚ â”‚ â”‚ â”œâ”€â”€ bm25/                  # BM25 æ£€ç´¢
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ bm25_engine.py
â”‚ â”‚ â”‚ â”œâ”€â”€ vector/                # å‘é‡æ£€ç´¢
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ milvus_client.py
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ vector_engine.py
â”‚ â”‚ â”‚ â”œâ”€â”€ rerank/                # é‡æ’åº
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ reranker.py
â”‚ â”‚ â”‚ â””â”€â”€ hybrid_retriever.py    # æ··åˆæ£€ç´¢å…¥å£
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ llm/                     # å¤§æ¨¡å‹å­ç³»ç»Ÿ
â”‚ â”‚ â”‚ â”œâ”€â”€ prompt/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ base_prompt.py
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ qa_prompt.py
â”‚ â”‚ â”‚ â”œâ”€â”€ llm_client.py
â”‚ â”‚ â”‚ â””â”€â”€ generator.py
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ permission/             # æƒé™å­ç³»ç»Ÿï¼ˆé¢„ç•™ï¼‰
â”‚ â”‚ â”‚ â””â”€â”€ permission_checker.py
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ cache/                  # ç¼“å­˜å­ç³»ç»Ÿ
â”‚ â”‚ â””â”€â”€ redis_client.py
â”‚ â”‚
â”‚ â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚ â”‚ â”œâ”€â”€ document.py             # æ–‡æ¡£ / Chunk æ¨¡å‹
â”‚ â”‚ â”œâ”€â”€ query.py                # Query / Response æ¨¡å‹
â”‚ â”‚ â””â”€â”€ user.py
â”‚ â”‚
â”‚ â”œâ”€â”€ repository/               # æ•°æ®è®¿é—®å±‚ï¼ˆDAOï¼‰
â”‚ â”‚ â”œâ”€â”€ document_repo.py
â”‚ â”‚ â”œâ”€â”€ vector_repo.py
â”‚ â”‚ â””â”€â”€ query_log_repo.py
â”‚ â”‚
â”‚ â””â”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚ â”œâ”€â”€ file_utils.py
â”‚ â”œâ”€â”€ text_utils.py
â”‚ â””â”€â”€ hash_utils.py
â”‚
â”œâ”€â”€ docker/                     # å®¹å™¨ç›¸å…³
â”‚ â”œâ”€â”€ docker-compose.yml
â”‚ â””â”€â”€ milvus/
â”‚
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•
â”‚ â”œâ”€â”€ raw_docs/                 # åŸå§‹æ–‡æ¡£
â”‚ â””â”€â”€ processed/                # å¤„ç†åçš„ä¸­é—´æ•°æ®
â”‚
â”œâ”€â”€ scripts/                    # è¾…åŠ©è„šæœ¬
â”‚ â”œâ”€â”€ init_milvus.py
â”‚ â”œâ”€â”€ ingest_docs.py
â”‚ â””â”€â”€ rebuild_index.py
â”‚
â”œâ”€â”€ tests/                      # æµ‹è¯•ç”¨ä¾‹
â”‚
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ requirements.txt            # Python ä¾èµ–
â””â”€â”€ README.md
```
## ç³»ç»Ÿæ•´ä½“æ¶æ„
```
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   Client     â”‚
           â”‚  (Web / API) â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   FastAPI    â”‚
           â”‚  API Layer   â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚     RAG æ ¸å¿ƒæµç¨‹          â”‚
     â”‚  Query â†’ Retrieval â†’ LLM â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ£€ç´¢å­ç³»ç»Ÿ â”‚   â”‚  LLM å­ç³»ç»Ÿ â”‚
   â”‚ BM25 / å‘é‡â”‚   â”‚ Prompt + æ¨ç†â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Milvus     â”‚   â”‚   å¤§æ¨¡å‹ API â”‚
â”‚ å‘é‡æ•°æ®åº“   â”‚   â”‚ (å¯æ›¿æ¢)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  MySQLï¼šæ–‡æ¡£ / å…ƒæ•°æ® / æ—¥å¿—
  Redisï¼šç¼“å­˜ / Query ç»“æœ
```

## æ ¸å¿ƒåŠŸèƒ½

1ï¸âƒ£ æ–‡æ¡£å¤„ç†ï¼ˆDocument Pipelineï¼‰

#### æ”¯æŒæ ¼å¼ï¼š

  PDF
  
  Wordï¼ˆ.doc / .docxï¼‰

  æ‰«æç‰ˆæ–‡æ¡£ï¼ˆOCRï¼‰

#### å¤„ç†æµç¨‹ï¼š

  æ–‡æ¡£åŠ è½½ï¼ˆLoaderï¼‰
  
  å†…å®¹è§£æï¼ˆParserï¼‰
  
  æ–‡æœ¬æ¸…æ´—ï¼ˆCleanerï¼‰
  
  Chunk åˆ‡åˆ†ï¼ˆSplitterï¼‰
  
  å…ƒæ•°æ®å°è£…ï¼ˆMetadataï¼‰

2ï¸âƒ£ å‘é‡åŒ–ï¼ˆEmbeddingï¼‰

  æ”¯æŒæ‰¹é‡æ–‡æœ¬å‘é‡ç”Ÿæˆ
  
  å‘é‡ä¸ Chunk å…ƒæ•°æ®è§£è€¦å­˜å‚¨
  
  å¯æ›¿æ¢ä¸åŒ Embedding æ¨¡å‹ï¼ˆå¦‚ BGE / E5 / OpenAIï¼‰

3ï¸âƒ£ æ£€ç´¢ç³»ç»Ÿï¼ˆRetrievalï¼‰

#### ğŸ”¹ å‘é‡æ£€ç´¢

  åŸºäº Milvus
  
  æ”¯æŒ TopKã€ç›¸ä¼¼åº¦é˜ˆå€¼

#### ğŸ”¹ å…³é”®è¯æ£€ç´¢

  åŸºäº BM25
  
  æå‡é•¿æ–‡æœ¬ / ä¸“ä¸šæœ¯è¯­å¬å›ç‡

#### ğŸ”¹ æ··åˆæ£€ç´¢ï¼ˆHybrid Retrievalï¼‰

  å‘é‡æ£€ç´¢ + BM25
  
  ç»“æœåˆå¹¶ + å»é‡ + åŠ æƒ

#### ğŸ”¹ é‡æ’åºï¼ˆRerankï¼‰

  å¯¹å€™é€‰ Chunk è¿›è¡Œç›¸å…³æ€§ç²¾æ’
  
  å‡å°‘æ— å…³ä¸Šä¸‹æ–‡æ³¨å…¥

4ï¸âƒ£ å¤§æ¨¡å‹ç”Ÿæˆï¼ˆLLMï¼‰

  Prompt æ¨¡æ¿åŒ–ç®¡ç†
  
  #### å¼ºçº¦æŸå›ç­”æ¥æºï¼š
  
  æœªæ£€ç´¢åˆ°å†…å®¹ â†’ æ˜ç¡®è¿”å›ã€Œæ–‡æ¡£ä¸­æœªæ‰¾åˆ°ã€

#### æ”¯æŒï¼š

  ç§æœ‰åŒ–æ¨¡å‹
  
  äº‘ç«¯ APIï¼ˆå¯æ›¿æ¢ï¼‰

5ï¸âƒ£ ç¼“å­˜ä¸æ—¥å¿—

#### Redisï¼š

  Query â†’ Answer ç¼“å­˜
  
  é™ä½å¤§æ¨¡å‹è°ƒç”¨æˆæœ¬

#### MySQLï¼š

  æ–‡æ¡£ä¿¡æ¯
  
  Chunk å…ƒæ•°æ®
  
  é—®ç­”æ—¥å¿—ï¼ˆå¯ç”¨äºè¯„ä¼°ä¸å¾®è°ƒï¼‰

## ç›®å½•ç»“æ„è¯´æ˜
```
enterprise_rag/
â”œâ”€â”€ app/                # ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ main.py         # é¡¹ç›®å…¥å£
â”‚   â”œâ”€â”€ api/            # API æ¥å£å±‚
â”‚   â”œâ”€â”€ core/           # æ ¸å¿ƒé…ç½® / æ—¥å¿— / å¸¸é‡
â”‚   â”œâ”€â”€ services/       # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ repository/     # DAO æ•°æ®è®¿é—®å±‚
â”‚   â””â”€â”€ utils/          # å·¥å…·ç±»
â”‚
â”œâ”€â”€ docker/             # Docker & Compose
â”œâ”€â”€ data/               # åŸå§‹æ–‡æ¡£ / ä¸­é—´æ•°æ®
â”œâ”€â”€ scripts/            # åˆå§‹åŒ– & æ•°æ®å¯¼å…¥è„šæœ¬
â”œâ”€â”€ tests/              # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ .env                # ç¯å¢ƒå˜é‡
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```
## å¿«é€Ÿå¯åŠ¨
1ï¸âƒ£ ç¯å¢ƒè¦æ±‚
  Windows / Linux
  
  Docker & Docker Compose
  
  Python â‰¥ 3.9
  
2ï¸âƒ£ å¯åŠ¨åŸºç¡€æœåŠ¡
```
cd docker
docker-compose up -d
```
#### å¯åŠ¨æœåŠ¡åŒ…æ‹¬ï¼š

  Milvus
  
  MySQL
  
  Redis
  
3ï¸âƒ£ åˆå§‹åŒ–å‘é‡åº“

python scripts/init_milvus.py

4ï¸âƒ£ æ–‡æ¡£å…¥åº“

python scripts/ingest_docs.py

5ï¸âƒ£ å¯åŠ¨ API æœåŠ¡

python app/main.py

## RAG é—®ç­”æµç¨‹è¯´æ˜
```
ç”¨æˆ·æé—®
   â†“
Query é¢„å¤„ç†
   â†“
æ··åˆæ£€ç´¢ï¼ˆå‘é‡ + BM25ï¼‰
   â†“
Rerank ç²¾æ’
   â†“
æ„é€  Promptï¼ˆä»…ä½¿ç”¨æ£€ç´¢å†…å®¹ï¼‰
   â†“
LLM ç”Ÿæˆç­”æ¡ˆ
   â†“
ç¼“å­˜ & æ—¥å¿—è®°å½•
```

å…³é”®è®¾è®¡ç‚¹ï¼š

â— æ²¡æ£€ç´¢åˆ°å†…å®¹ â†’ ä¸è°ƒç”¨ LLM

â— Prompt æ˜ç¡®é™åˆ¶æ¨¡å‹ä¸å¾—ç¼–é€ 

â— æ£€ç´¢ä¸ç”Ÿæˆå®Œå…¨è§£è€¦ï¼Œä¾¿äºæ‰©å±• Agent

## å¯æ‰©å±•æ–¹å‘

ğŸ”¹ Agent å¤šå·¥å…·è°ƒç”¨

ğŸ”¹ å¤šçŸ¥è¯†åº“ / å¤šç§Ÿæˆ·

ğŸ”¹ SSO / æƒé™æ§åˆ¶

ğŸ”¹ Query è´¨é‡è¯„ä¼°ä¸è‡ªåŠ¨è°ƒä¼˜

ğŸ”¹ å¾®è°ƒ / RAG è¯„æµ‹é—­ç¯

## é€‚ç”¨åœºæ™¯

ä¼ä¸šå†…éƒ¨çŸ¥è¯†åº“

å·¥ç¨‹ / è¿ç»´ / æ³•å¾‹ / åˆ¶åº¦é—®ç­”

ç§æœ‰æ–‡æ¡£æ™ºèƒ½æ£€ç´¢

ç§æœ‰åŒ–å¤§æ¨¡å‹åº”ç”¨

